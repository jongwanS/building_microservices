# 10 모니터링에서 관찰가능성으로
- 모놀리스 애플리케이션에서 작동했던 도구와 기술이 마이크로서비스 아키텍처에서는 적합하지 않다.
- 시스템을 마이크로서비스로 분해하면 **새로운 복잡성을 유발**한다.
- 이장에서는 **관찰가능성 개념**에 대해 알아본다.
  - 관찰가능성 : 무엇이 잘못됐는지 파악하도록 `시스템에 질문할 수 있는 방법`

> **운영 환경의 고충**
> - 실제 마이크로서비스를 운영하기 전까진 고통을 이해하지 못한다.
## 10.1 분열, 공황 그리고 혼란
- 단일 프로세스형 모놀리식은 오류 추적이 다소 쉽다.
  - 단일 장애 지점이 있으면 장애 추적은 간단해진다.

- **마이크로서비스의 장애는 추적하기가 까다롭다**.
  - 서비스 기능이 여러 마이크로서비스에 의해 제공된다.
  - 오류가 발생할 수 있는 표면적이 늘어나 확인 해야할 사항도 늘어난다.
- **마이크로서비스 모니터링 방법**
  - 작은 것을 모니터링하고 더 큰 그림을 볼 수 있도록 **집계**(aggretation)**를 제공**해야 한다.
  - 집계데이터를 데이터 조각으로 나누는 도구를 선택해야 한다.
  - 운영 환경에서 테스트한다는 개념을 수용해 시스템 정상 상태(health)에 대해 현명한 사고방식을 가져야 한다.
## 10.2 단일 마이크로서비스, 단일 서버
- 단일 호스트, 단일 서비스
- 문제가 발생했을 때 무엇을 모니터링 해야 할까?
- CPU, 메모리, 로그, 웹서버 로그, 상태 확인(health check)  
  
![1](./images/ch10/img.png)  
출처 : 한빛미디어 - 마이크로서비스 아키텍처 구축  
## 10.3 단일 마이크로서비스, 다수 서버
- 다수 호스트, 단일 서비스
- `서비스별로 문제를 격리`할 수 있는 방향으로 모니터링 해야한다.
  - 다수 호스트 메트릭정보를 수집해 분할하고 분석하는 방법 필요하다.
    - 로드밸런서 응답 시간 추적, SSH 멀티플렉서를 사용해 애플리케이션 로그 분석
  
![1](./images/ch10/img_1.png)  
출처 : 한빛미디어 - 마이크로서비스 아키텍처 구축  
## 10.4 다수 마이크로서비스, 다수 서버
- 다수의 마이크로서비스와 서버로 구성된 환경은 **복잡성**을 가지고 있ㄷ다.
- 수많은 로그에서 오류를 찾는 것은 어렵다.
  - **서버 단위의 문제인지 전체적인 문제**인지 판단할 수 있어야 한다.
  - 호스트 간 호출 체인에서 발생하는 **오류를 추적하고 해결하는 것이 필요**합니다.
- 정보 수집(**메트릭 및 로그**)과, 데이터를 효과적으로 이해하고 **선별**하는 것이 필요하다.
- 적극적인 관찰 가능성과 **운영 환경에서의 테스트로** 사고방식을 전환하는데 필요합니다.
  
![1](./images/ch10/img_2.png)  
출처 : 한빛미디어 - 마이크로서비스 아키텍처 구축  
## 10.5 관찰가능성 대 모니터링
- **관찰가능성**
  - 시스템의 `외부 출력을 통해 내부 상태를 이해할 수 있는 수준`을 의미한다.
  - 소프트웨어를 서로 다른 개체의 집합이 아닌 **하나의 시스템**으로 보는 것아 도 중요하다.
- **모니터링**
  - `시스템을 관찰하고 주시`하는 활동
  - 전통적인 모니터링은 `문제 예측`과 `경고 메커니즘` 중심
  - 하지만, 시스템이 점점 더 분산됨에 따라 **발생하지 않았을 문제에도 직면**
- **고도로 관측 가능한 시스템**을 활용하여 다양한 질문을 할 수 있는 **외부 출력을 제공**해야 한다.
  - 모니터링을 시스템의 속성인 **관찰가능성의 활동**으로 바라봐야 한다.

> 외부 출력  
> - 시스템이나 소프트웨어의 동작에 대한 결과를 의미
> - 시스템이 생성하는 메트릭은 CPU 사용량, 메모리 사용량, 네트워크 트래픽 등과 같은 정보
## 10.5.1 관찰가능성의 주축? 그다지 빠르지 않다
- 관찰 가능성은 주로 메트릭, 로깅, 분산 추적이라는 세 가지 주축에 집중된다.
  - 뉴렐릭 MELT(metrics, event, logs, traces)
- 이러한 접근은 너무 **환원주의적**이고 **핵심을 놓칠 수 있다**.
- 이러한 개념 사이에는 항상 명확한 경계가 존재하지 않을 수 있다.
- 관찰 가능성은 시스템의 작업을 이해하는 데 도움을 주는 이벤트, 로그, 메트릭 등을 포함한다.
- 필요한 것은 시스템을 이해하고 문제를 해결하는 데 집중하는 것이다.
- **시스템을 관찰 가능하게 만들 때 어떤 정보를 수집하고 분석할 것인지를 고려해야 한다**
> **note**  
> - 로그, 이벤트, 메트릭은 대상을 관찰 가능하게 만들도록 도와주지만, 
> - 많은 도구를 사용하기보다는 **시스템을 이해할 수 있도록 만드는 데 집중**해야 한다.

## 10.6 관찰가능성의 구성 요소
- 문제가 있다면, 사용자가 발견하기 전에 그 문제를 알아야 한다.
- 충분한 정보를 갖고 문제가 재발되지 않도록 해야 한다.
[시스템 아키텍처 관찰 가능성 개선할 수 있는 구성요소]
- **로그집계**
  - 여러 마이크로서비스 정보를 수집, **모니터링 및 관찰가능성의 구성요소** 
- **메트릭 집계**
  - 마이크로서비스와 인프라 수치를 캡처해 문제를 탐지, 용량 계획 추진
- **분산 추적**
  - 무엇이 잘못됐는지 파악 및 정확한 지연 시간 정보를 도출하기 위해, **마이크로서비스 경계에서 호출 흐름 추적** 
- **지금 괜찮은가?**
  - 에러 예산, SLA, SLO 마이크로서비스가 요구 사항을 충족하는지 확인하는 과정
- **알림**
  - 무엇을 알려야 할까? 좋은 알림이란 무엇일까?
- **시맨틱 모니터링**
- **운영 환경에서 테스팅**
  - 운영 환경의 다양한 테스트 기법에 대한 요약
### 10.6.1 로그 집계
### 10.6.2 메트릭 집계
### 10.6.3 분산 추적
### 10.6.4 잘하고 있나요?
### 10.6.5 알림
### 10.6.6 시맨틱 모니터링
### 10.6.7 운영 환경에서 테스팅

## 10.7 표준화

## 10.8 도구 선택
### 10.8.1 민주적 선택
### 10.8.2 쉬운 통합
### 10.8.3 맥락 제공
### 10.8.4 실시간
### 10.8.5 규모에 맞게

## 10.9 기계화된 전문가

## 10.10 시작하기

#### 요약
