# 워크플로
- 마이크로서비스 분산 트랜잭션
- 마이크로서비스 워크플로 모델링 할 수 있는 사가 패턴
## 6.1 데이터베이스 트랜잭션
- 트랜잭션을 단일 단위로 취급
  - 하나의 트랜잭션 내에서 전체가 실패하거나 성공한다.(일관성)

## 6.1.1 ACID 트랜잭션
- 데이터베이스 트랜잭션은 ACID 트랜잭션을 의미한다.
- ACID
  - `원자성(Atomicity)`
    - 트랜잭션 내 작업(DML)이 전체 성공 하거나 전체 실패 "All or Nothing"
  - `일관성 (Consistency)`
    - 데이터베이스가 변경되면, 유효하고 일관된 상태 유지(무결성, 칼럼타입, pk, fk ...)
  - `격리성 (Isolation)`
    - 여러 트랜잭션 간섭 없이 동시에 작동, 각 트랜잭션은 독립적으로 실행되는 것처럼 보이도록 보장
      - Dirty Read : 1번 트랜잭션이 데이터 수정(커밋전), 2번 트랜잭션이 데이터 조회시 1번 트랜잭션의 수정 내용을 2번 트랜잭션은 모른다.
      - Non-Repeatable Read : 1번 트랜잭션이 select 쿼리, 2번 트랜잭션이 update, 1번이 다시 select 했을때 2번트랜잭션이 반영한 데이터가 나온다.
      - Phantom Read : 하나의 트랜잭션이 범위 기반의 쿼리를 실행하는 동안 다른 트랜잭션이 같은 범위 내에서 데이터를 추가 또는 삭제하는 경우.
  - `지속성 (Durability)`
    - 트랜잭션이 성공적으로 완료된 후에는 해당 변경 사항이 영구적으로 저장

````
모든 데이터베이스가 ACID를 제공하는 것은 아님
> Neo4j 등
````
## 6.1.2 여전히 ACID이지만 원자성은 부족한가?
- 단일 ACID 트랜잭션

- 고객 및 등록 마이크로서비스 2개의 별도 트랜잭션
  - 각 자기 DB에 대한 ACID만 보장받는다.
  - 원자성 보장 X
## 6.2 분산 트랜잭션 - 2단계 커밋

## 6.3 분산 트랜잭션 - 그냥 안 된다고 하라

## 6.4 사가 패턴
## 6.4.1 사가 실패 모드
## 6.4.2 사가 패턴 구현
## 6.4.3 사가와 분산 트랜잭션의 비교








