# 11 보안
- 보안이라는 주제에 대해 인식을 갖추는 것은 **처음부터 소프트웨어 보안을 구축하는 데 필요**하다.
- 단일 머신에서 유지되던 데이터가 마이크로서비스로 넘어가며 **네트워크를 통해 더 많이 흐르고 있어** **공격 표면이 훨씬 더 넓다.**
- 아이러니하게도 마이크로서비스는 **심층 방어를 할 수 있고 접근 범위를 제한**하는 더 많은 기회를 제공한다.
  - **잠재적으로 시스템 보호 기능을 더욱 강화하는 동시에 공격이 발생할 경우 영향을 줄인다.** 
> 마이크로서비스 아키텍처의 **보안과 관련해 올바른 균형을 찾는 데 도움이 되는 주제**들이 있다.  
> - 핵심 원칙
>    - 보다 안전한 소프트웨어를 구축하려 할 때 수용하는 데 유용한 기본 개념 
>  - 사이버 보안의 다섯 가지 기능
>    - 애플리케이션 보안을 위한 다섯 가지 주요 기능 영역(식별, 보호, 탐지, 대응, 복구)에 대한 개요
>  - 애플리케이션 보안의 기초
>    - 애플리케이션 보안의 특정한 몇 가지 기본 개념과 자격 증명, 보안, 패치 백업, 재빌드를 포함해 마이크로서비스에 적용하는 방법
>  - 암묵적 신뢰 대 제로 트러스트
>    - 마이크로서비스 환경에서 신뢰를 위한 다양한 접근 방식과 이 방식이 보안 관련 활동에 미치는 영향
>  - 데이터 보안
>    - 데이터가 네트워크를 통해 이동하고 디스크에 저장될 때 데이터를 보호하는 방법
>  - 인증 및 권한 부여
>    - 마이크로서비스 아키텍처에서 SSO(Single Sign-On)가 작동하는 방식, 중앙 집중식 대 분산식 인증모델, 그 일부인 JWT 토큰의 역할 

## 11.1 핵심 원칙
- 알아둬야 할 수많은 문제를 조명하기 위해 간략히 살펴봐야 하는 **애플리케이션 보안의 몇 가지 기본 측면**이 있다.
  - 안전한 소프트웨어를 구축하려 할 때 수용하는 데 유용한 기본 개념
### 11.1.1 최소 권한의 원칙
- 개인, 외/내부 시스템, 마이크로서비스 애플리케이션 **액세스 권한에 주의를 기울여야 한다.**
- **최소 권한의 원칙**(principle of least privilege)은 권한 부여시, **최소한의 액세스 권한을 필요한 기간동안 부여하는 개념**이다.
### 11.1.2 심층 방어
- 애플리케이션 보안에 보호 기능을 구축할 때 공격자로부터 방어하기 위해 **여러 보호 장치를 갖추는 것이 중요**하다.
  - 마이크로서비스로 분리하고, **수행할 수 있는 범위를 제한 하는 방법**
  - 네트워크 보안
- 마이크로서비스는 하나의 제로 데이 취약점이 전체에 영향을 끼치지 않도록 할 수 있다.
  - 제로 데이 취약점 : 아직까지 패치되지 않은 보안 취약점을 이용한 해킹의 통칭
- **마이크로서비스는** 단일 모놀리식 애플리케이션 보다 **더 심층적으로 방어하는 기능을 제공**하여 조직이 더 안전한 시스템을 구축하도록 돕는다.

> **보안 통제 유형** : 시스템 보안을 위해 적용하는 보안통제를 다음과 같이 분류
> - 예방형(preventive)
>   - 공격이 발생하지 않도록 secret 안전하게 저장, 데이터 암호화, 적절한 인증 및 권한 부여를 구현 
> - 탐지형(detective)
>   - 공격이 발생하고 있거나 발생했다는 사실을 알려준다. 방화벽 또는 침입 탐지 서비스가 예시 이다.
> - 대응형(responsive)
>   - 공격 중 또는 공격 후 대응을 돕는다. 시스템을 재구축하는 자동화된 매커니즘, 데이터 복구를 위한 백업

### 11.1.3 자동화
- 마이크로서비스 아키텍처에서 동작 부분이 훨씬 더 많아지면서 **자동화는 복잡한 시스템을 관리하기 위한 핵심 개념**이 되었다.
  - 컴퓨터는 우리보다 더 빠르고 효율적으로 작업을 수행하며 변동성도 적다.
  - 인적 오류 최소화 가능하다.
  - **자동화는 사건 발생 후 복구하는 데 도움이 된다.**
    - 보안키를 취소하거나 교체하고 도구를 사용해 보안 문제를 보다 쉽게 감지할 수 있다.
    - 자동화 문화를 수용하면 보안과 관련해 큰 도움이 될 것 이다.
### 11.1.4 제공 프로세스에 보안 주입
- **보안은 사후에 고려되는 사항으로 간주되는 경우가 흔하다.**
- **개발자가 보안 관련 사항에 보다 일반적인 인식을 갖게 만들고, 보안 전문가가 제공 팀에 합류할 수 있는 방법을 찾으며, 보안 관련 개념을 소프트웨어에 구축할 수 있도록** 해야 한다.
  - 교차 사이트 스크립팅(XSS)과 같이 시스템 취약성을 조사할 수 있는 자동화된 도구(`ZAP`, Zed Attack Proxy)
  - 루비를 위한 `브레이크맨`(적정 분석)
  - 제삼자 라이브러리에 알려진 의존성 취약점을 찾아내는 `스니크`
- 이러한 도구들은 **CI 빌드에 통합할 수 있으므로 표준 체크인에 통합하는 것이 좋은 출발점**이 될 수 있다.

## 11.2 사이버 보안의 다섯 가지 기능
- 애플리케이션 보안 5가지 모델(NIST, National Institute of Standards and Techonologty)
1) 잠재적인 공격자가 누구인지, 공격 대상이 무엇인지, 가장 취약한 곳은 어디인지 **식별하라.**
2) 잠재적인 해커로부터 주요 자산을 **보호하라.**
3) 최선의 노력에도 불구하고 공격이 발생했는지 **감지하라.**
4) 나쁜 일이 발생했다는 것을 알게 되면 **대응하라.**
5) 사고 발생후 **복구하라.**

- **애플리케이션 보호뿐 아니라, 실제로 직면할 수 있는 위험을 고려해야 한다.**

### 11.2.1 식별
- 공격 대상, 그들이 무엇을 찾고 있는지 알아야 한다.
- 애플리케이션 보안에서 이와 같은 측면을 다룰때 살펴봐야할 것이 **위협 모델링**(threat modeling) 이다.
- 마이크로서비스 아키텍처 맥락에서 개발자와 이야기해보면, JWT 및 상호 TLS에 대해 이야기한다.
  - 시스템, 기량, 경험에 대한 제한된 시각에 크게 좌우 받는다.
  - 하지만 이것은 세상을 제한된 시각으로 바라본다는 점이다.
  - 이러한 관점은 안전한 정문과 활짝 열린 뒷문을 가진 상황을 초래할 수 있다.
- 모든 요소를 고려하고 가장 큰 위험이 어디에 있는지 파악할 시간을 가져야 시간을 더 효율적으로 쓸 수 있다.
- **위협 모델링의 목표**는 **공격자가 시스템에서 원하는 것이 무엇인지 이해하도록 도와준다.**
  - 위협 모델링을 제대로 수행하려면 공격자의 입장이 돼 외부에서 내부를 들여다 보는 것이 중요하다.
  - 위협 모델링을 수행할때는 시스템의 작은 집합이 아닌 **전체적으로 살펴봐야 한다.**
### 11.2.2 보호
- 취약한 자산을 식별한 후에는 **자산이 적절하게 보호되는지 확인해야 한다.**
- 마이크로서비스 아키텍처는 **공격할 수 있는 표면적이 훨씬 넓기 때문에** 보호해야 할 대상도 많고, **심층 방어를 위한 많은 방법도 제공**한다.
### 11.2.3 탐지
- **마이크로서비스 아키텍처는 장애 감지가 더 복잡하다.**
  - 모니터링해야 할 네트워크와 감시해야 할 기계가 더 많기 때문이다.
- **원천 정보가 크게 증가해 문제 탐지도 어렵다.**
  - 로그집계와 같은 많은 기술을 통해 감지하는 정보를 수집하는 데 도움이 된다.
- 불량 행위를 탐지하는 침입 탐지(intrusion detection)시스템과 같은 특수한 도구가 있다.
  - 아쿠아(Aqua)와 같은 도구(Aqua Security는 컨테이너, 쿠버네티스, 서버리스 및 기타 클라우드 네이티브 애플리케이션의 보안을 제공하는 플랫폼)
### 11.2.4 대응
### 11.2.5 복구
## 11.3 애플리케이션 보안의 기초
### 11.3.1 자격 증명
### 11.3.2 패치
### 11.3.3 백업
### 11.3.4 재구축
## 11.4 암묵적 신뢰 대 제로 트러스트
### 11.4.1 암묵적 신뢰
### 11.4.2 제로 트러스트
### 11.4.3 스펙트럼
## 11.5 데이터 보안
### 11.5.1 전송 중인 데이터
### 11.5.2 보안 중인 데이터
## 11.6 인증과 권한 부여
### 11.6.1 서비스 간 인증
### 11.6.2 사람 인증
### 11.6.3 일반적인 SSO 구현
### 11.6.4 일반적인 SSO 구현
### 11.6.5 세밀한 권한 부여
### 11.6.6 혼동된 대리인 문제
### 11.6.7 중앙 집중식 업스트림 권한 부여
### 11.6.8 분산식 권한 부여
### 11.6.9 JSON 웹 토큰

#### 요약





![1](./images/ch11/img.png)  
출처 : 한빛미디어 - 마이크로서비스 아키텍처 구축
